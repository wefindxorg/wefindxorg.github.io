!function(){function t(t,n,e){var a=t.translate(),o=Math.atan2(n[1]-a[1],n[0]-a[0])-Math.atan2(e[1]-a[1],e[0]-a[0]);return[Math.cos(o/2),0,0,Math.sin(o/2)]}function n(t,n){var e=t.invert(n);return e&&isFinite(e[0])&&isFinite(e[1])&&c(e)}function e(t){var n=.5*t[0]*l,e=.5*t[1]*l,a=.5*t[2]*l,o=Math.sin(n),r=Math.cos(n),i=Math.sin(e),c=Math.cos(e),s=Math.sin(a),h=Math.cos(a);return[r*c*h+o*i*s,o*c*h-r*i*s,r*i*h+o*c*s,r*c*s-o*i*h]}function a(t,n){var e=t[0],a=t[1],o=t[2],r=t[3],i=n[0],c=n[1],s=n[2],h=n[3];return[e*i-a*c-o*s-r*h,e*c+a*i+o*h-r*s,e*s-a*h+o*i+r*c,e*h+a*s-o*c+r*i]}function o(t,n){if(t&&n){var e=h(t,n),a=Math.sqrt(s(e,e)),o=.5*Math.acos(Math.max(-1,Math.min(1,s(t,n)))),r=Math.sin(o)/a;return a&&[Math.cos(o),e[2]*r,-e[1]*r,e[0]*r]}}function r(t,n){var e=Math.max(-1,Math.min(1,s(t,n))),a=0>e?-1:1,o=Math.acos(a*e),r=Math.sin(o);return r?function(e){var i=a*Math.sin((1-e)*o)/r,c=Math.sin(e*o)/r;return[t[0]*i+n[0]*c,t[1]*i+n[1]*c,t[2]*i+n[2]*c,t[3]*i+n[3]*c]}:function(){return t}}function i(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*f,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*f,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*f]}function c(t){var n=t[0]*l,e=t[1]*l,a=Math.cos(e);return[a*Math.cos(n),a*Math.sin(n),Math.sin(e)]}function s(t,n){for(var e=0,a=t.length,o=0;a>e;++e)o+=t[e]*n[e];return o}function h(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function u(t){for(var n=0,e=arguments.length,a=[];++n<e;)a.push(arguments[n]);var o=d3.dispatch.apply(null,a);return o.of=function(n,e){return function(a){try{var r=a.sourceEvent=d3.event;a.target=t,d3.event=a,o[a.type].apply(n,e)}finally{d3.event=r}}},o}var l=Math.PI/180,f=180/Math.PI;d3.geo.zoom=function(){function s(t){m++||t({type:"zoomstart"})}function h(t){t({type:"zoom"})}function l(t){--m||t({type:"zoomend"})}var f,d,M,m=0,v=u(g,"zoomstart","zoom","zoomend"),g=d3.behavior.zoom().on("zoomstart",function(){var r=d3.mouse(this),c=e(f.rotate()),u=n(f,r);u&&(M=u),p.call(g,"zoom",function(){f.scale(z.k=d3.event.scale);var e=d3.mouse(this),s=o(M,n(f,e));f.rotate(z.r=i(c=s?a(c,s):a(t(f,r,e),c))),r=e,h(v.of(this,arguments))}),s(v.of(this,arguments))}).on("zoomend",function(){p.call(g,"zoom",null),l(v.of(this,arguments))}),p=g.on,z={r:[0,0,0],k:1};return g.rotateTo=function(t){var n=o(c(t),c([-z.r[0],-z.r[1]]));return i(a(e(z.r),n))},g.projection=function(t){return arguments.length?(f=t,z={r:f.rotate(),k:f.scale()},g.scale(z.k)):f},g.duration=function(t){return arguments.length?(d=t,g):d},g.event=function(t){t.each(function(){var t=d3.select(this),n=v.of(this,arguments),a=z,o=d3.transition(t);if(o!==t){o.each("start.zoom",function(){this.__chart__&&(z=this.__chart__),f.rotate(z.r).scale(z.k),s(n)}).tween("zoom:zoom",function(){var t=g.size()[0],c=r(e(z.r),e(a.r)),s=d3.geo.distance(z.r,a.r),u=d3.interpolateZoom([0,0,t/z.k],[s,0,t/a.k]);return d&&o.duration(d(.001*u.duration)),function(e){var a=u(e);this.__chart__=z={r:i(c(a[0]/s)),k:t/a[2]},f.rotate(z.r).scale(z.k),g.scale(z.k),h(n)}}).each("end.zoom",function(){l(n)});try{o.each("interrupt.zoom",function(){l(n)})}catch(c){}}else this.__chart__=z,s(n),h(n),l(n)})},d3.rebind(g,v,"on")}}(),function(){function t(t){return{moveTo:function(n,a){t.moveTo(Math.round(n*e),Math.round(a*e))},lineTo:function(n,a){t.lineTo(Math.round(n*e),Math.round(a*e))},closePath:function(){t.closePath()}}}var n=180/Math.PI,e=window.devicePixelRatio||1,a=$("#banner-content").width(),o=850,r=e,i=d3.geo.orthographic().rotate([0,-30]).scale(o/2-1).translate([a/2,o/2]).clipExtent([[-r,-r],[a+r,o+r]]).precision(.5),c=d3.select("#map").append("canvas").attr("width",a*e).attr("height",o*e).style("width",a+"px").style("height",o+"px"),s=c.node().getContext("2d"),h=d3.geo.path().projection(i).context(t(s)),u=d3.select("#north-up").on("change",function(){u=this.checked}).property("checked");d3.json("./world-110m.json",function(t,r){function l(){f(i,g[p=((z=p)+1)%g.length]),c.transition().ease("quad-in-out").duration(2e3).call(b.projection(i).event)}function f(t,n){var e=d3.geo.centroid(n),r=t.clipExtent();t.rotate(u?[-e[0],-e[1]]:b.rotateTo(e)).clipExtent(null).scale(1).translate([0,0]);var i=h.bounds(n),c=Math.min(1e3,.45/Math.max(Math.max(Math.abs(i[1][0]),Math.abs(i[0][0]))/a,Math.max(Math.abs(i[1][1]),Math.abs(i[0][1]))/o));t.clipExtent(r).scale(c).translate([a/2,o/2])}var d={type:"Sphere"},M=d3.geo.graticule()(),m=topojson.feature(r,r.objects.land),v=topojson.mesh(r,r.objects.countries),g=d3.shuffle(topojson.feature(r,r.objects.countries).features),p=-1,z=p,b=d3.geo.zoom().projection(i).duration(function(t){return 2e3*Math.sqrt(t)}).scaleExtent([o/2-1,1/0]).on("zoom",function(){i.clipAngle(Math.asin(Math.min(1,.5*Math.sqrt(a*a+o*o)/i.scale()))*n),s.clearRect(0,0,a*e,o*e),s.strokeStyle="#000000",s.lineWidth=.5*e,s.beginPath(),h(M),s.stroke(),s.fillStyle="rgba(0, 0, 0, 0.1)",s.beginPath(),h(m),s.fill(),s.fillStyle="#rgba(255, 0, 0, 0.4)",s.beginPath(),h(g[z]),s.fill(),s.fillStyle="#rgba(0, 255, 0, 0.4)",s.beginPath(),h(g[p]),s.fill(),s.strokeStyle="#000000",s.lineWidth=.5*e,s.beginPath(),h(v),s.stroke(),s.strokeStyle="#000",s.lineWidth=2*e,s.beginPath(),h(d),s.stroke()}).on("zoomend",l);c.call(b).call(b.event)})}();